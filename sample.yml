apiVersion: iceberg/v1
spec:
  listen: ":8081"
  configs:
    cors: 
      origin: ""
      methods: ""
      headersAllowed: ""
      headersExposed: ""
      maxAge: ""
  resources:
    - name: freeze
      frontend: /
      backend: http://127.0.0.1:8080
      filterChains: 
        - name: payment-intent
          listener: "natsch:10000://[[default-nats]]/internal.middleware.paymentintent"
          level: "request"
          timeout: 30
          exchange: 
            headers: 
              - x-payment-token
          callbacks: 
            - name: generate-receipt
              listener: "natsch:10000://[[default-nats]]/internal.middleware.receipt"
              parallel: true
              timeout: 30
            - name: generate-receipt-alternate
              listener: "natsch:10000://[[default-nats]]/internal.middleware.receipt"
              parallel: true
              timeout: 30              
            - name: awaiter-1
              timeout: 30
              await: 
                - generate-receipt    
                - generate-receipt-alternate          